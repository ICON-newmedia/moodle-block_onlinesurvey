{"version":3,"file":"modal-zoom.min.js","sources":["../src/modal-zoom.js"],"sourcesContent":["define(['jquery', 'core/templates', 'core/modal', 'core/modal_registry', 'core/modal_factory', 'core/modal_events'],\n    function($, templates, Modal, ModalRegistry, ModalFactory, ModalEvents) {\n\n    var modalTitle = '';\n    var modalZoomSelector = '#block_onlinesurvey_surveys_content';\n\n    var popupinfotitle = '';\n    var popupinfocontent = '';\n    var userlogintime = 0;\n\n    var doRefresh = function() {\n        var myElement = document.getElementById(\"block_onlinesurvey_contentframe\");\n        if (myElement) {\n            var oldsrc = myElement.src;\n            myElement.src = '';\n            myElement.src = oldsrc;\n        }\n    };\n\n    var handleClickSmallModal = function(e) {\n        e.preventDefault();\n\n        var modalZoomElem = e.target;\n\n        var originalIframe = modalZoomElem.querySelector('iframe');\n\n        var modalPromise = null;\n        var templatePromise = null;\n        modalPromise = ModalFactory.create({type: ModalFactory.types.DEFAULT, large: true, title: modalTitle});\n        if (originalIframe !== null) {\n            // Open from Moodle page, i.e., onlinesurvey iframe exists.\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        } else {\n            // Open from iframe, i.e., needs to switch to parent Moodle page.\n            originalIframe = parent.document.querySelector('iframe');\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        }\n\n        $.when(templatePromise, modalPromise).done(function(source, iframemodal) {\n            iframemodal.setBody(source);\n            iframemodal.getModal().addClass('modal-xl');\n            iframemodal.getRoot().on(ModalEvents.hidden, function() {\n                // Refresh when hidden.\n                doRefresh();\n            });\n\n            iframemodal.show();\n        });\n    };\n\n    return {\n        init: function(popuptitle, popupcontent, currentlogin) {\n\n            popupinfotitle = popuptitle;\n            popupinfocontent = popupcontent;\n            userlogintime = currentlogin;\n\n            var zoomContainer = document.querySelectorAll(modalZoomSelector);\n\n            for (var i = 0; i < zoomContainer.length; i++) {\n                zoomContainer[i].addEventListener('click', handleClickSmallModal);\n            }\n\n            // Namespace in window for EVASYS-functions etc.\n            window.EVASYS = {\n                // Define \"global\" functions in namespace -> later \"external\" access from iframe possible.\n                generatepopupinfo: this.generatepopupinfo\n            };\n            window.evasysGeneratePopupinfo = this.generatepopupinfo;\n        },\n        generatepopupinfo: function() {\n\n            // Get saved data from sessionStorage.\n            var popupinfo = sessionStorage.getItem('onlinesurvey_popupinfo');\n\n            if (popupinfo == false || popupinfo === null || popupinfo != userlogintime) {\n\n                // Save data to sessionStorage.\n                sessionStorage.setItem('onlinesurvey_popupinfo', userlogintime);\n\n                var modalPromise = ModalFactory.create(\n                    {\n                        type:ModalFactory.types.DEFAULT,\n                        body: popupinfocontent,\n                        title: popupinfotitle,\n                        large: true\n                    }\n                );\n                modalPromise.done(function(popupmodal) {\n                    popupmodal.getModal().addClass('modal-xl');\n                    popupmodal.getRoot().on(ModalEvents.hidden, function() {\n                        // Refresh when hidden.\n                        doRefresh();\n                    });\n                    popupmodal.show();\n                });\n            }\n        }\n    };\n});\n"],"names":["define","$","templates","Modal","ModalRegistry","ModalFactory","ModalEvents","popupinfotitle","popupinfocontent","userlogintime","doRefresh","myElement","document","getElementById","oldsrc","src","handleClickSmallModal","e","preventDefault","modalPromise","originalIframe","target","querySelector","templatePromise","create","type","types","DEFAULT","large","title","parent","render","when","done","source","iframemodal","setBody","getModal","addClass","getRoot","on","hidden","show","init","popuptitle","popupcontent","currentlogin","zoomContainer","querySelectorAll","i","length","addEventListener","window","EVASYS","generatepopupinfo","this","evasysGeneratePopupinfo","popupinfo","sessionStorage","getItem","setItem","body","popupmodal"],"mappings":"AAAAA,uCAAO,CAAC,SAAU,iBAAkB,aAAc,sBAAuB,qBAAsB,sBAC3F,SAASC,EAAGC,UAAWC,MAAOC,cAAeC,aAAcC,iBAKvDC,eAAiB,GACjBC,iBAAmB,GACnBC,cAAgB,EAEhBC,UAAY,eACRC,UAAYC,SAASC,eAAe,sCACpCF,UAAW,KACPG,OAASH,UAAUI,IACvBJ,UAAUI,IAAM,GAChBJ,UAAUI,IAAMD,SAIpBE,sBAAwB,SAASC,GACjCA,EAAEC,qBAMEC,aAFAC,eAFgBH,EAAEI,OAEaC,cAAc,UAG7CC,gBAAkB,KACtBJ,aAAed,aAAamB,OAAO,CAACC,KAAMpB,aAAaqB,MAAMC,QAASC,OAAO,EAAMC,MAzBtE,KA0BU,OAAnBT,iBASAA,eAAiBU,OAAOlB,SAASU,cAAc,WAP/CC,gBAAkBrB,UAAU6B,OAAO,kCAAmC,CAElEhB,IAAKK,eAAeL,IAAM,eAC1Bc,MA/BK,KA2Cb5B,EAAE+B,KAAKT,gBAAiBJ,cAAcc,MAAK,SAASC,OAAQC,aACxDA,YAAYC,QAAQF,QACpBC,YAAYE,WAAWC,SAAS,YAChCH,YAAYI,UAAUC,GAAGlC,YAAYmC,QAAQ,WAEzC/B,eAGJyB,YAAYO,iBAIb,CACHC,KAAM,SAASC,WAAYC,aAAcC,cAErCvC,eAAiBqC,WACjBpC,iBAAmBqC,aACnBpC,cAAgBqC,qBAEZC,cAAgBnC,SAASoC,iBA7Db,uCA+DPC,EAAI,EAAGA,EAAIF,cAAcG,OAAQD,IACtCF,cAAcE,GAAGE,iBAAiB,QAASnC,uBAI/CoC,OAAOC,OAAS,CAEZC,kBAAmBC,KAAKD,mBAE5BF,OAAOI,wBAA0BD,KAAKD,mBAE1CA,kBAAmB,eAGXG,UAAYC,eAAeC,QAAQ,0BAEtB,GAAbF,WAAoC,OAAdA,WAAsBA,WAAahD,gBAGzDiD,eAAeE,QAAQ,yBAA0BnD,eAE9BJ,aAAamB,OAC5B,CACIC,KAAKpB,aAAaqB,MAAMC,QACxBkC,KAAMrD,iBACNqB,MAAOtB,eACPqB,OAAO,IAGFK,MAAK,SAAS6B,YACvBA,WAAWzB,WAAWC,SAAS,YAC/BwB,WAAWvB,UAAUC,GAAGlC,YAAYmC,QAAQ,WAExC/B,eAEJoD,WAAWpB"}